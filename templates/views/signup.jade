extends ../layouts/base

block defines
  - name = 'signup';
  - title = 'OpenMRS ID- Sign Up';
  - headline = 'Sign up for OpenMRS ID <small>Already have one? <a href="/login"> Sign in.</a></small>';
  - showSidebar = true;
  - sidebar = ['id-whatis'];
  - fail = fail || {};
  - failReason = failReason || {};
  - values = values || {};

append head
  script(type='text/javascript')!= 'var SPINNER = "' + spinner + '";'

  script(src='https://www.google.com/recaptcha/api.js')
  script(src='/bower_components/cryptojslib/rollups/md5.js')
  script(type='text/javascript').
    var disguise = function scrambleFields(name, spin) {
        var text = name + SPINNER;
        var hash = CryptoJS.MD5(text);
        return hash.toString(CryptoJS.enc.hex);
    };
    $(document).ready(function() {
      $('#country').parent().css('display', 'none');
      var tmp = $('#username');
      if (tmp.val() === '') {
        return tmp.focus();
      }
      tmp = $('#firstName');
      if (tmp.val() === '') {
        return tmp.focus();
      }
      tmp = $('#lastName');
      if (tmp.val() === '') {
        return tmp.focus();
      }
      tmp = $('#primaryEmail');
      if (tmp.val() === '') {
        return tmp.focus();
      }
      tmp = $('#password');
      if (tmp.val() === '') {
        return tmp.focus();
      }
    });

block content
  div.panel
    form(action='/signup', method='post', autocomplete='off')

      div.row(class=(fail.username?'fail':undefined))
        input.col-md-5#username(type='text',
              name=disguise('username', spinner),
              placeholder='Username',
              value=(values.username || undefined)
              )

        span.description
          span.failtext
            if (failReason.username)
              = failReason.username
            else
              | Please enter a valid username.
          | Only lowercase letters and numbers are allowed. (0-9, a-z).

      div.row(class={fail: fail.firstName || fail.lastName})
        div.col-md-5.no-padding
          div.col-md-6.left
            input.col-md-12#fisrtName(type='text',
                  name=disguise('firstName', spinner),
                  placeholder='Given Name',
                  value=(values.firstName || undefined)
                  )

          div.col-md-6.right
            input.col-md-12#lastName(type='text',
                  name=disguise('lastName', spinner),
                  placeholder='Surname',
                  value=(values.lastName || undefined)
                  )

        span.description
          span.failtext Both a given name and surname are required.

      div.row(class={fail: fail.primaryEmail})
        input.col-md-5#primaryEmail(type='text', name=disguise('primaryEmail', spinner),
              placeholder='Email Address',
              value=(values.primaryEmail || undefined)
              )

        span.description
          span.failtext
            if (failReason.primaryEmail)
              = failReason.primaryEmail
            else
              | Please enter a valid email address.<% } %>

      //- conuntry, honeypot field
      div.row
        input.col-md-5#country(type='text', name=disguise('country', spinner)
              placeholder='Country')

        span.description
          span.failtext Please enter a country.
          | Help us learn where our community is from by providing your country.

      div.row(class={fail: fail.password})

        input.col-md-5#password(type='password', name=disguise('password', spinner),
              placeholder='Password')
        span.description
          span.failtext
            if (failReason.password)
              | failReason.password
            else
              | Please enter a valid password.
          | Passwords must be at least 8 characters long.

      div.g-recaptcha.row(data-sitekey=recaptchaPublic)

      input(type='hidden', name='spinner', value=spinner)
      input(type='hidden', name=disguise('timestamp', spinner),
            value=timestamp)

      div.row
        input.btn.btn-success.col-md-3(type='submit', value='Join the Community Â»')
